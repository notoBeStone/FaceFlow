# Survey æ¨¡å— - å–æ¶ˆè®¢é˜…é—®å·

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

å–æ¶ˆè®¢é˜…é—®å·æ¨¡å—è´Ÿè´£åœ¨ç”¨æˆ·å–æ¶ˆè®¢é˜…ã€è¯•ç”¨å³å°†è¿‡æœŸæˆ–å·²è¿‡æœŸæ—¶ï¼Œæ”¶é›†ç”¨æˆ·åé¦ˆï¼Œå¸®åŠ©äº§å“ä¼˜åŒ–ã€‚é€šè¿‡ç–²åŠ³åº¦æ§åˆ¶æœºåˆ¶ï¼Œç¡®ä¿ç”¨æˆ·ä¸è¢«é‡å¤æ‰“æ‰°ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- âœ… **æ™ºèƒ½è§¦å‘**ï¼šè‡ªåŠ¨æ£€æµ‹ç”¨æˆ·ä¼šå‘˜çŠ¶æ€ï¼Œåœ¨åˆé€‚æ—¶æœºå±•ç¤ºé—®å·
- âœ… **ç–²åŠ³åº¦æ§åˆ¶**ï¼šç¡®ä¿åŒç±»å‹é—®å·åªå±•ç¤ºä¸€æ¬¡
- âœ… **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**ï¼šå»¶è¿Ÿå±•ç¤ºï¼Œé¿å…ä¸å…¶ä»–å¯åŠ¨æµç¨‹å†²çª
- âœ… **å®Œæ•´åŸ‹ç‚¹**ï¼šè¿½è¸ªå±•ç¤ºã€å…³é—­ã€æäº¤ç­‰æ‰€æœ‰ç”¨æˆ·è¡Œä¸º
- âœ… **æ¶æ„è§„èŒƒ**ï¼šç¬¦åˆ HackWeek ComposablePageComponent æ¶æ„

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
MainAppView (é¦–é¡µ)
    â†“ onAppear æ£€æŸ¥
SurveyFatigueManager (ç–²åŠ³åº¦ç®¡ç†å™¨)
    â†“ shouldShowSurvey()
Navigator.present()
    â†“
TrialCancelSurveyPage (åŒ…è£…ç»„ä»¶)
    â†“
TrialCancelSurveyView (UI å®ç°)
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
HackWeek/Features/Survey/
â”œâ”€â”€ SurveyFatigueManager.swift      # ç–²åŠ³åº¦ç®¡ç†å™¨ï¼ˆå•ä¾‹ï¼‰
â”œâ”€â”€ TrialCancelSurveyPage.swift     # é—®å·é¡µé¢åŒ…è£…ç»„ä»¶
â””â”€â”€ README.md                       # æœ¬æ–‡æ¡£

HackWeek/Features/
â””â”€â”€ TrialCancelSurveyView.swift     # é—®å· UI å®ç°ï¼ˆå·²æœ‰ï¼‰

HackWeek/Features/WordBook/
â””â”€â”€ MainAppView.swift               # é¦–é¡µé›†æˆç‚¹
```

## ğŸ”‘ æ ¸å¿ƒç»„ä»¶

### 1. SurveyFatigueManager

**èŒè´£**ï¼šç®¡ç†é—®å·å±•ç¤ºé¢‘ç‡å’Œå†å²è®°å½•

**å…³é”®æ–¹æ³•**ï¼š
```swift
// æ£€æŸ¥æ˜¯å¦åº”è¯¥å±•ç¤ºé—®å·
func shouldShowSurvey() -> Bool

// è®°å½•é—®å·å·²å±•ç¤º
func markSurveyShown(type: SurveyCancelType? = nil)

// è®°å½•ç”¨æˆ·æäº¤
func markSurveySubmitted()

// è®°å½•ç”¨æˆ·å…³é—­
func markSurveyDismissed()

// é‡ç½®çŠ¶æ€ï¼ˆæµ‹è¯•ç”¨ï¼‰
func resetState()
```

**å­˜å‚¨æœºåˆ¶**ï¼š
- ä½¿ç”¨ `UserDefaults` æŒä¹…åŒ–å­˜å‚¨
- è®°å½•å·²å±•ç¤ºçš„é—®å·ç±»å‹ã€æäº¤çŠ¶æ€ã€å…³é—­æ¬¡æ•°ç­‰

### 2. TrialCancelSurveyPage

**èŒè´£**ï¼šç¬¦åˆ ComposablePageComponent çš„é¡µé¢ç»„ä»¶åŒ…è£…

**Props**ï¼š
```swift
struct TrialCancelSurveyPageProps {
    let surveyType: SurveyCancelType    // é—®å·ç±»å‹
    let onDismiss: (() -> Void)?        // å…³é—­å›è°ƒ
}
```

**ç‰¹æ€§**ï¼š
- è‡ªåŠ¨é›†æˆé¡µé¢è¿½è¸ª
- å¤„ç†å±•ç¤ºã€å…³é—­ã€æäº¤çš„ç”Ÿå‘½å‘¨æœŸ
- è°ƒç”¨ SurveyFatigueManager è®°å½•ç”¨æˆ·è¡Œä¸º

### 3. TrialCancelSurveyView

**èŒè´£**ï¼šé—®å· UI å®ç°ï¼ˆå·²æœ‰ç»„ä»¶ï¼Œå·²å¢å¼ºï¼‰

**å¢å¼ºç‚¹**ï¼š
- æ–°å¢ `onDismissAction` å›è°ƒ
- æ–°å¢ `onSubmitAction` å›è°ƒ
- æ”¯æŒå¤–éƒ¨æ§åˆ¶å…³é—­é€»è¾‘

### 4. SurveyCancelType

**èŒè´£**ï¼šå®šä¹‰é—®å·è§¦å‘ç±»å‹ï¼ˆå·²æœ‰æšä¸¾ï¼‰

**ç±»å‹**ï¼š
```swift
enum SurveyCancelType {
    case trialCancelled  // è¯•ç”¨æœŸå–æ¶ˆ
    case expireSoon      // å³å°†è¿‡æœŸï¼ˆ7å¤©å†…ï¼‰
    case expired         // å·²è¿‡æœŸ
    case unknown         // æœªçŸ¥/ä¸è§¦å‘
}
```

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨ï¼ˆé¦–é¡µè‡ªåŠ¨è§¦å‘ï¼‰

é—®å·ä¼šåœ¨ `MainAppView` åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶å±•ç¤ºï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ã€‚

### æ‰‹åŠ¨è§¦å‘ï¼ˆå¯é€‰ï¼‰

```swift
// æ£€æŸ¥æ˜¯å¦åº”è¯¥å±•ç¤º
if SurveyFatigueManager.shared.shouldShowSurvey() {
    let surveyType = SurveyFatigueManager.shared.getCurrentSurveyType()
    
    Navigator.present(
        TrialCancelSurveyPage(
            props: TrialCancelSurveyPageProps(
                surveyType: surveyType,
                onDismiss: {
                    print("é—®å·å·²å…³é—­")
                }
            )
        ),
        from: "custom_page"
    )
}
```

### é‡ç½®çŠ¶æ€ï¼ˆæµ‹è¯•ï¼‰

```swift
// æ¸…é™¤æ‰€æœ‰è®°å½•ï¼Œé‡æ–°è§¦å‘é—®å·ï¼ˆä»…ç”¨äºå¼€å‘æµ‹è¯•ï¼‰
SurveyFatigueManager.shared.resetState()
```

### æŸ¥çœ‹å†å²è®°å½•

```swift
let history = SurveyFatigueManager.shared.getHistory()
print(history)
// è¾“å‡ºï¼š
// é—®å·å†å²è®°å½•:
// - å·²å±•ç¤ºç±»å‹: trialCancelled, expireSoon
// - æœ€åå±•ç¤ºæ—¶é—´: 2025-10-16 10:30:00
// - å·²æäº¤: true
// - å…³é—­æ¬¡æ•°: 2
```

## ğŸ§ª æµ‹è¯•æŒ‡å—

### æµ‹è¯•ç”¨ä¾‹

| æµ‹è¯•åœºæ™¯ | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ |
|---------|---------|---------|
| **é¦–æ¬¡è¯•ç”¨å–æ¶ˆ** | 1. é‡ç½®çŠ¶æ€<br>2. æ¨¡æ‹Ÿè¯•ç”¨å–æ¶ˆ<br>3. å¯åŠ¨åº”ç”¨ | å»¶è¿Ÿ1.5ç§’åå±•ç¤ºé—®å· |
| **é¦–æ¬¡å³å°†è¿‡æœŸ** | 1. é‡ç½®çŠ¶æ€<br>2. æ¨¡æ‹Ÿ7å¤©å†…è¿‡æœŸ<br>3. å¯åŠ¨åº”ç”¨ | å»¶è¿Ÿ1.5ç§’åå±•ç¤ºé—®å· |
| **é¦–æ¬¡å·²è¿‡æœŸ** | 1. é‡ç½®çŠ¶æ€<br>2. æ¨¡æ‹Ÿä¼šå‘˜å·²è¿‡æœŸ<br>3. å¯åŠ¨åº”ç”¨ | å»¶è¿Ÿ1.5ç§’åå±•ç¤ºé—®å· |
| **äºŒæ¬¡è¿›å…¥** | 1. é¦–æ¬¡å±•ç¤ºåå…³é—­<br>2. é‡æ–°å¯åŠ¨åº”ç”¨ | ä¸å†å±•ç¤ºé—®å· |
| **æäº¤å** | 1. æäº¤é—®å·<br>2. é‡æ–°å¯åŠ¨åº”ç”¨ | ä¸å†å±•ç¤ºé—®å· |
| **æœªæ»¡è¶³æ¡ä»¶** | 1. æ­£å¸¸ä¼šå‘˜çŠ¶æ€<br>2. å¯åŠ¨åº”ç”¨ | ä¸å±•ç¤ºé—®å· |

### æµ‹è¯•æ­¥éª¤

#### 1. é‡ç½®æµ‹è¯•çŠ¶æ€

```swift
// åœ¨è°ƒè¯•ä»£ç ä¸­è°ƒç”¨ï¼ˆæˆ–ä½¿ç”¨ Xcode æ–­ç‚¹æ‰§è¡Œï¼‰
SurveyFatigueManager.shared.resetState()
```

#### 2. æ¨¡æ‹Ÿä¼šå‘˜çŠ¶æ€

ç”±äºé—®å·è§¦å‘ä¾èµ– `GL().Account_*` ç³»åˆ—æ¥å£ï¼Œéœ€è¦ï¼š
- ä½¿ç”¨æµ‹è¯•è´¦å·ï¼ˆè¯•ç”¨ä¼šå‘˜ã€å³å°†è¿‡æœŸä¼šå‘˜ã€å·²è¿‡æœŸä¼šå‘˜ï¼‰
- æˆ–è€…ä¿®æ”¹ `SurveyCancelType` çš„åˆ¤æ–­é€»è¾‘è¿›è¡Œæµ‹è¯•

#### 3. éªŒè¯å±•ç¤ºé€»è¾‘

- å¯åŠ¨åº”ç”¨ï¼Œè¿›å…¥ `MainAppView`
- ç­‰å¾… 1.5 ç§’
- è§‚å¯Ÿæ˜¯å¦å¼¹å‡ºé—®å·

#### 4. éªŒè¯åŸ‹ç‚¹

ä½¿ç”¨æŠ“åŒ…å·¥å…·æˆ– Firebase/Analytics åå°æŸ¥çœ‹äº‹ä»¶ï¼š
- `survey_cancel_show`ï¼šé—®å·å±•ç¤º
- `survey_cancel_dismiss`ï¼šé—®å·å…³é—­
- `trialcancelsurvey_submit_click`ï¼šé—®å·æäº¤

### è°ƒè¯•æŠ€å·§

#### æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—

åœ¨ DEBUG æ¨¡å¼ä¸‹ï¼Œ`SurveyFatigueManager` ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼š
```
ğŸ¯ [SurveyFatigueManager] é—®å·åº”è¯¥å±•ç¤º: type = trialCancelled
ğŸ¯ [SurveyFatigueManager] å·²è®°å½•é—®å·å±•ç¤º: type = trialCancelled
ğŸ¯ [SurveyFatigueManager] å·²è®°å½•ç”¨æˆ·å…³é—­é—®å·ï¼Œå…³é—­æ¬¡æ•°: 1
```

#### æ–­ç‚¹è°ƒè¯•ä½ç½®

1. `MainAppView.checkAndShowSurvey()` - æ£€æŸ¥è§¦å‘é€»è¾‘
2. `SurveyFatigueManager.shouldShowSurvey()` - éªŒè¯åˆ¤æ–­æ¡ä»¶
3. `TrialCancelSurveyPage.onAppear` - ç¡®è®¤é¡µé¢å±•ç¤º

## ğŸ“ˆ åŸ‹ç‚¹äº‹ä»¶

### 1. survey_cancel_show
**è§¦å‘æ—¶æœº**ï¼šé—®å·å±•ç¤ºæ—¶
**å‚æ•°**ï¼š
- `type`: é—®å·ç±»å‹ï¼ˆtrialCancelled / expireSoon / expiredï¼‰
- `from`: æ¥æºé¡µé¢ï¼ˆmain_appï¼‰

### 2. survey_cancel_dismiss
**è§¦å‘æ—¶æœº**ï¼šç”¨æˆ·ç‚¹å‡»"Not Now"å…³é—­é—®å·
**å‚æ•°**ï¼š
- `type`: é—®å·ç±»å‹
- `content`: not_now

### 3. trialcancelsurvey_submit_click
**è§¦å‘æ—¶æœº**ï¼šç”¨æˆ·æäº¤é—®å·
**å‚æ•°**ï¼š
- `content`: ç”¨æˆ·é€‰æ‹©å’Œåé¦ˆå†…å®¹ï¼ˆæ ¼å¼ï¼šreason1:feedback1;reason2:feedback2ï¼‰

## âš™ï¸ é…ç½®å‚æ•°

### å±•ç¤ºå»¶è¿Ÿæ—¶é—´

å½“å‰è®¾ç½®ä¸º **1.5 ç§’**ï¼Œå¯åœ¨ `MainAppView.checkAndShowSurvey()` ä¸­è°ƒæ•´ï¼š
```swift
DispatchQueue.main.asyncAfter(deadline: .now() + 1.5) {
    showSurvey()
}
```

### é—®å·è§¦å‘æ¡ä»¶

åœ¨ `SurveyCancelType` ä¸­å®šä¹‰ï¼š
- **è¯•ç”¨å–æ¶ˆ**ï¼šè¯•ç”¨ä¼šå‘˜ && æœªè‡ªåŠ¨ç»­è®¢
- **å³å°†è¿‡æœŸ**ï¼šä»˜è´¹ä¼šå‘˜ && æœªè‡ªåŠ¨ç»­è®¢ && 7å¤©å†…è¿‡æœŸ
- **å·²è¿‡æœŸ**ï¼šå†å²ä¼šå‘˜ || è¯•ç”¨å·²è¿‡æœŸ

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šé—®å·æ²¡æœ‰å±•ç¤º

**å¯èƒ½åŸå› **ï¼š
1. æœªæ»¡è¶³è§¦å‘æ¡ä»¶ï¼ˆæ£€æŸ¥ä¼šå‘˜çŠ¶æ€ï¼‰
2. å·²å±•ç¤ºè¿‡ç›¸åŒç±»å‹ï¼ˆæ£€æŸ¥å†å²è®°å½•ï¼‰
3. ç”¨æˆ·å·²æäº¤è¿‡é—®å·ï¼ˆæ£€æŸ¥æäº¤çŠ¶æ€ï¼‰
4. å»¶è¿Ÿæ—¶é—´å†…é¡µé¢å·²å…³é—­

**è§£å†³æ–¹æ³•**ï¼š
```swift
// 1. æŸ¥çœ‹å†å²è®°å½•
print(SurveyFatigueManager.shared.getHistory())

// 2. é‡ç½®çŠ¶æ€
SurveyFatigueManager.shared.resetState()

// 3. æ£€æŸ¥ä¼šå‘˜çŠ¶æ€
let type = SurveyFatigueManager.shared.getCurrentSurveyType()
print("å½“å‰é—®å·ç±»å‹: \(type)")

// 4. æ£€æŸ¥æ˜¯å¦åº”è¯¥å±•ç¤º
let should = SurveyFatigueManager.shared.shouldShowSurvey()
print("æ˜¯å¦åº”è¯¥å±•ç¤º: \(should)")
```

### é—®é¢˜ï¼šé—®å·é‡å¤å±•ç¤º

**å¯èƒ½åŸå› **ï¼š
1. `hasSurveyChecked` çŠ¶æ€æœªæ­£ç¡®ç®¡ç†
2. UserDefaults å­˜å‚¨å¤±è´¥

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥ `MainAppView` çš„ `@State` å˜é‡
- éªŒè¯ UserDefaults è¯»å†™æƒé™

### é—®é¢˜ï¼šåŸ‹ç‚¹æœªä¸ŠæŠ¥

**å¯èƒ½åŸå› **ï¼š
1. GLMPTracking æœªæ­£ç¡®åˆå§‹åŒ–
2. ç½‘ç»œé—®é¢˜
3. å‚æ•°æ ¼å¼é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥ Analytics é…ç½®
- ä½¿ç”¨æŠ“åŒ…å·¥å…·éªŒè¯ç½‘ç»œè¯·æ±‚
- æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯æ—¥å¿—

## ğŸš€ æœªæ¥ä¼˜åŒ–æ–¹å‘

### Phase 2
- [ ] æ”¯æŒæœåŠ¡ç«¯é…ç½®å±•ç¤ºé€»è¾‘
- [ ] å¢åŠ é—®å·å±•ç¤ºé—´éš”é…ç½®ï¼ˆå¦‚30å¤©åå¯å†æ¬¡å±•ç¤ºï¼‰
- [ ] A/B æµ‹è¯•æ”¯æŒ
- [ ] å¤šè¯­è¨€æ”¯æŒ

### Phase 3
- [ ] ä¸ªæ€§åŒ–é—®å·ï¼ˆåŸºäºç”¨æˆ·ç”»åƒï¼‰
- [ ] æ¿€åŠ±æœºåˆ¶ï¼ˆæä¾›ä¼˜æƒ åˆ¸ï¼‰
- [ ] å¯è§†åŒ–æ•°æ®åˆ†æåå°
- [ ] æµå¤±é¢„è­¦ç³»ç»Ÿ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [CLAUDE.md](../../../CLAUDE.md) - é¡¹ç›®æ•´ä½“æ¶æ„
- [Navigator ä½¿ç”¨æŒ‡å—](../../../Documentation/Guides/Navigator_Usage_Guide.md)
- [VipConversion æ¨¡å—](../../../Documentation/Modules/VipConversion/README.md)

## ğŸ¤ è´¡çŒ®æŒ‡å—

å¦‚éœ€ä¿®æ”¹æ­¤æ¨¡å—ï¼š
1. éµå¾ª HackWeek æ¶æ„è§„èŒƒ
2. ä½¿ç”¨ ComposablePageComponent åè®®
3. ç¡®ä¿åŸ‹ç‚¹å®Œæ•´
4. æ·»åŠ å¿…è¦çš„æµ‹è¯•ç”¨ä¾‹
5. æ›´æ–°æœ¬æ–‡æ¡£

---

**åˆ›å»ºæ—¶é—´**: 2025-10-16  
**æœ€åæ›´æ–°**: 2025-10-16  
**ç»´æŠ¤è€…**: AI Assistant  
**ç‰ˆæœ¬**: v1.0

